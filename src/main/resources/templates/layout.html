<!DOCTYPE html>
<html lang="pt-BR" xmlns:th="http://www.thymeleaf.org"
      xmlns:sec="http://www.thymeleaf.org/extras/spring-security">
<head th:fragment="head">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title th:text="${pageTitle}">Filadelfia Store</title>
    <link th:href="@{/css/style.css}" rel="stylesheet"/>
    <link th:fragment="modalStyles" th:href="@{/css/modal.css}" rel="stylesheet"/>
    <link rel="icon" type="image/x-icon" th:href="@{/images/favicon.ico}"/>
</head>
<body>
    <header th:fragment="header">
        <div class="container">
            <div class="header-content">
                <h1>Sistema de Gerenciamento</h1>
                
                <!-- User info and logout button - only visible when authenticated -->
                <div class="user-section" sec:authorize="isAuthenticated()">
                    <span class="user-name">
                        <th:block th:text="${#authentication.principal.name}">Usuário</th:block>
                    </span>
                    <form th:action="@{/logout}" method="post" style="display: inline;">
                        <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}"/>
                        <button type="submit" class="btn-logout">Sair</button>
                    </form>
                </div>
                
                <!-- Login link for non-authenticated users -->
                <div class="login-section" sec:authorize="!isAuthenticated()">
                    <a th:href="@{/login}" class="btn-login">Entrar</a>
                </div>
            </div>
            
            <!-- Role-based navigation -->
            <div class="tabs">
                <!-- Public/Home tab -->
                <a class="tab" 
                   sec:authorize="!isAuthenticated()"
                   th:classappend="${activePage == 'home'} ? 'active'" 
                   th:href="@{/}">
                    Início
                </a>
                
                <!-- ADMIN Dashboard -->
                <a class="tab" 
                   sec:authorize="hasRole('ADMIN')"
                   th:classappend="${activePage == 'admin'} ? 'active'" 
                   th:href="@{/admin}">
                    Painel Admin
                </a>
                
                <!-- MANAGER Dashboard -->
                <a class="tab" 
                   sec:authorize="hasRole('MANAGER')"
                   th:classappend="${activePage == 'manager'} ? 'active'" 
                   th:href="@{/manager}">
                    Painel Gerente
                </a>
                
                <!-- USER Profile -->
                <a class="tab" 
                   sec:authorize="hasRole('USER')"
                   th:classappend="${activePage == 'profile'} ? 'active'" 
                   th:href="@{/profile}">
                    Meu Perfil
                </a>
                
                <!-- Shopping Cart - USER only -->
                <a class="tab" 
                   sec:authorize="hasRole('USER')"
                   th:classappend="${activePage == 'cart'} ? 'active'" 
                   th:href="@{/cart}">
                    Carrinho
                </a>
                
                <!-- My Orders - USER only -->
                <a class="tab" 
                   sec:authorize="hasRole('USER')"
                   th:classappend="${activePage == 'orders'} ? 'active'" 
                   th:href="@{/orders/my}">
                    Meus Pedidos
                </a>
                
                <!-- Management sections for ADMIN and MANAGER -->
                <a class="tab" 
                   sec:authorize="hasAnyRole('ADMIN', 'MANAGER')"
                   th:classappend="${activePage == 'products'} ? 'active'" 
                   th:href="@{/products}">
                    Produtos
                </a>
                
                <a class="tab"
                   sec:authorize="hasAnyRole('ADMIN', 'MANAGER')"
                   th:classappend="${activePage == 'categories'} ? 'active'" 
                   th:href="@{/categories}">
                    Categorias
                </a>
                
                <a class="tab" 
                   sec:authorize="hasAnyRole('ADMIN', 'MANAGER')"
                   th:classappend="${activePage == 'orders'} ? 'active'" 
                   th:href="@{/orders/manage}">
                    Gerenciar Pedidos
                </a>
                
                <!-- Users management - ADMIN only -->
                <a class="tab" 
                   sec:authorize="hasRole('ADMIN')"
                   th:classappend="${activePage == 'users'} ? 'active'" 
                   th:href="@{/users}">
                    Usuários
                </a>
            </div>
        </div>
    </header>

    <main th:fragment="content">
        
    </main>

    <div th:fragment="notifications">
        <!-- Logout success notification -->
        <div class="notification-success" th:if="${param.logout}">
            <p class="notification-title">Logout realizado com sucesso!</p>
            <p>Você foi desconectado do sistema.</p>
        </div>

        <div class="notification-error" th:if="${error}">
            <p class="notification-title" th:text="${error}"></p>
            <p th:text="${errorDescription}"></p>
            <a th:if="${notificationMessage}" th:href="${notificationHref}" th:text="${notificationMessage}"></a>
        </div>

        <div class="notification-info" th:if="${info}">
            <p class="notification-title" th:text="${info}"></p>
            <p th:text="${infoDescription}"></p>
            <a th:if="${notificationMessage}" th:href="${notificationHref}" th:text="${notificationMessage}"></a>
        </div>

        <div class="notification-success" th:if="${success}">
            <p class="notification-title" th:text="${success}"></p>
            <p th:text="${successDescription}"></p>
            <a th:if="${notificationMessage}" th:href="${notificationHref}" th:text="${notificationMessage}"></a>
        </div>
    </div>

    <div th:fragment="scripts">
        <script th:src="@{/js/core/form_manager.js}"></script>
        <script th:src="@{/js/core/http_client.js}"></script>
        <script th:src="@{/js/core/loading_manager.js}"></script>
        <script th:src="@{/js/core/notification_manager.js}"></script>
    </div>

    <footer th:fragment="footer">
        <p>&copy; 2025 Filadelfia Store - Todos os direitos reservados</p>
    </footer>
</body>
</html>